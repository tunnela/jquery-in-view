/*
 2015, Lauri Tunnela (http://tunne.la)
 @license http://tunne.la/MIT.txt The MIT License
*/
;!function(m,z,c,A){function v(f,a){var d=c(f);f=d.get(0);var b=function(a,b){var c=d.data("iv-"+a);null==c&&(c=d.attr("iv-"+a));null==c&&(c=b);return c},k=function(a,b){b=b||!1;return c.isFunction(a)?a.apply(f):b?c(a):a},n={},p=null,t=!1,r=0,e={count:parseInt(b("count",1)),classVisible:b("visible","in-view"),classHidden:b("hidden","out-of-view"),classInitial:b("initial","initial-view"),target:b("target",f),offset:b("offset","0"),marker:b("marker",""),markerCount:parseInt(b("marker-count",1))};a=c.extend({},
e,a);var h=a.offset.split(/\s*,\s*/),e=a.marker.split(/\s*,\s*/),l=h.length,g=c.isFunction(a.classInitial)?a.classInitial.apply(f):a.classInitial;d.addClass(g);d.trigger("initial-view");g={left:h[0],right:h[0],top:h[0],bottom:h[0]};4==l?(g.left=h[3],g.right=h[1],g.bottom=h[2]):2==l&&(g.left=h[1],g.right=h[1]);g.left=parseFloat(b("offset-left",g.left))||0;g.right=parseFloat(b("offset-right",g.right))||0;g.bottom=parseFloat(b("offset-bottom",g.bottom))||0;g.top=parseFloat(b("offset-top",g.top))||0;
a.offset=g;""==e[0]&&(e=[]);var q={},b=e.length;c.each(e,function(a,b){b=100*(parseFloat(b)||0);q[b]=b});if(e.length){e=e[0].match(/([0-9]+)\s*\/\s*([0-9]+)/);if(1===b&&e)for(b=parseFloat(e[2])||1,b=(parseFloat(e[1])||0)/(0==b?1:b),e=0,b=1/b;100>=e;e+=b)q[e]=e;q[0]=0;q[100]=100}a.marker=q;console.log(a.markerCount);this.check=function(){if(!t){t=!0;var b=p;p=c.isVisible(f,a.offset);var e=100*c.visiblityFactor(f),g=k(a.target,!0),h=k(a.classVisible);c.each(q,function(b,c){"undefined"===typeof n[c]&&
(n[c]=0);c<=e&&(!a.markerCount||n[c]++<a.markerCount)&&g.addClass(h+"-"+c);c>e&&(!a.markerCount||n[c]<a.markerCount)&&g.removeClass(h+"-"+c)});if(b!=p)if(b=k(a.classInitial),d.removeClass(b),p){if(d.trigger("in-view"),!a.count||r++<a.count)b=k(a.classHidden),g.length&&g.addClass(h).removeClass(b),d.trigger("in-view-pass")}else if(d.trigger("out-of-view"),!a.count||r<a.count)b=k(a.classHidden),g.length&&g.addClass(b).removeClass(h),d.trigger("out-of-view-pass");t=!1}};u=u.add(f);w||(w=!0,c(m).on("load scroll",
x))}var w=!1,y=0,l=[],u=c(),x=function(f){c(this).scrollTop();c(this).scrollLeft();u.each(function(){var a=l[c(this).data("in-view")];a instanceof v&&a.check()})};c.fn.inView=function(f){var a=[],d=this.each(function(){var b=c(this).data("in-view"),d=null;b&&"undefined"!==typeof l[b]?d=l[b]||null:(b=++y,c(this).data("in-view",b));null!==d&&f?a.push(d):(d=new v(this,f),l[b]=d)}),b=a.length;return b?1===b?a[0]:a:d};c.visiblityFactor=function(f){f=c(f).get(0);for(var a=f.offsetTop,d=f.offsetHeight;f.offsetParent;)f=
f.offsetParent,a+=f.offsetTop;return(m.pageYOffset+m.innerHeight-a)/d};c.isVisible=function(f,a){var d=c(f).get(0),b=d.offsetTop,k=d.offsetLeft,n=d.offsetWidth,p=d.offsetHeight,l=0,r=0,e=0,h=0;"undefined"!==typeof a&&(l=1<Math.abs(a.left)?a.left:a.left*n,r=1<Math.abs(a.right)?a.right:a.right*n,e=1<Math.abs(a.top)?a.top:a.top*p,h=1<Math.abs(a.bottom)?a.bottom:a.bottom*p);for(;d.offsetParent;)d=d.offsetParent,b+=d.offsetTop,k+=d.offsetLeft;return b+e<m.pageYOffset+m.innerHeight&&k+l<m.pageXOffset+m.innerWidth&&
b+p+h>m.pageYOffset&&k+n+r>m.pageXOffset};c(function(){c("[data-iv-detect=false],[iv-detect=false]").first().length||c("[data-iv],[iv]").inView()})}(window,document,window.Zepto||window.jQuery);